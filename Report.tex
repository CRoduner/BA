\documentclass[12pt, a4paper]{article} %[12pt, a4paper, twoside]{article}
\setlength{\hoffset}{-30pt}
\setlength{\textwidth}{450pt}
\setlength{\topmargin}{0pt}
%\usepackage[margin=100pt]{geometry}
\usepackage[utf8]{inputenc}
%\usepackage[T1]{fontenc}  %würde ä's über a's schiebeb
%\usepackage[lmodern]

\usepackage{amsmath}
\usepackage[]{units}
%\usepackage[]{natbib}
%\usepackage[backend=bibtex, style=numeric-comp]{biblatex}
%\bibliography{BALib.bib}

\usepackage{listings}
\usepackage{color}
\usepackage{graphicx}

\usepackage{float}		% Um Position der Bilder zu erzwingen  mit [H]

\usepackage{enumerate}
\usepackage[lofdepth,lotdepth]{subfig}
\usepackage[justification=centering]{caption}
\usepackage{url}
%\usepackage{here}
\lstset{
  language=Python,
  basicstyle=\footnotesize,
  %  numbers=left,                   % where to put the line-numbers
  stepnumber=1,                   % the step between two line-numbers.        
  numbersep=5pt,                  % how far the line-numbers are from the code
  backgroundcolor=\color{white},  % choose the background color. You must add \usepackage{color}
  showspaces=false,               % show spaces adding particular underscores
  showstringspaces=false,         % underline spaces within strings
  showtabs=false,                 % show tabs within strings adding particular underscores
  tabsize=2,                      % sets default tabsize to 2 spaces
  captionpos=b,                   % sets the caption-position to bottom
  breaklines=true,                % sets automatic line breaking
  breakatwhitespace=true,         % sets if automatic breaks should only happen at whitespace
  title=\lstname,                 % show the filename of files included with \lstinputlisting;
  keywordstyle=\bfseries\color[rgb]{0.7,0.1,0.3}, % coloring
  commentstyle=\color[rgb]{0.133,0.545,0.133}, % coloring
  stringstyle=\color[rgb]{1,0,0}, % coloring
  }
  
  \usepackage{todonotes}
  \newcommand{\todoRef}{\todo[color=green!20]}
  \newcommand{\todoEnglish}{\todo[color=red!20]}
  \newcommand{\todoFormat}{\todo[color=blue!20]}
  \newcommand{\todoWriteMore}{\todo[color=yellow!40, inline]}



\begin{document}

%\bibliographystyle{plainnat.bst}

\thispagestyle{empty}
\begin{center}
\Large{Philosophisch-Naturwissenschaftliche Fakultät}\\
\Large{University of Bern}\\
\end{center}


\begin{center}
\Large{Climate and Environmental Physics}
\end{center}
\begin{verbatim}



\end{verbatim}
\begin{center}
\large{Bachelor's Thesis on}
\end{center}
\begin{verbatim}

\end{verbatim}
\begin{center}
\textbf{\Large{Simulation of Atmosphere and Ocean Dynamics in a Water Tank}}\\
\end{center}

\begin{figure}[h]
 \centering
 \includegraphics[width=0.5\textwidth]{Title2.JPG}
\end{figure}

\begin{verbatim}


\end{verbatim}

\begin{center}
\begin{tabular}{llll}

\textbf{Author:} & & Cattia Roduner& \\
\textbf{Matriculation Number:} & & 10-120-335& \\
& & &\\
\textbf{Date:} & & \today &\\
& & &\\
\textbf{Advisor:} & & Patrik Pfister &\\

\end{tabular}

\end{center}
\newpage
\thispagestyle{empty}
\mbox{}

\newpage
\abstract
	The goal of this project is to numerically solve the Navier-Stokes equation for a rotating cylindrical water-filled tank using the finite difference method.
	In the thesis the Navier-Stokes equation is transformed into a rotating frame, converted into cylindrical coordinates and discretized. The area of the water tank is discretized by applying a staggered grid.
	The solution for one special case - the phenomenon of thermal wind - is implemented and visualized in Python and MayaVi. Due to problems with the readjustment of the pressure during the calculations, the Navier-Stokes equation could not be solved.

\newpage
\tableofcontents
\newpage
\listoffigures
\newpage


\section{Introduction}

	The dynamics of the ocean and the atmosphere have a major impact on the climate. Horizontal currents in the ocean, for example, can carry warmed or cooled water as far as several thousand kilometres. This water influences the temperature of the air above it and therefore of the regions where this air is blown. A well known example of this heat transport is the ``Gulf Stream'', which moves warm water north, across the Atlantic ocean, and causes a rather mild climate in Western Europe. Because they have such an influence on our climate, understanding these dynamics is an important subject for environmental studies. \\
	
	In the Lab Course, physics students of the University of Berne get a chance to investigate the properties of some principal large scale atmospheric and oceanic circulations in a water tank. In the experiment a relatively simple isolated system is observed. A water-filled plexiglass tank is placed on a turntable and rotated at a constant speed. By placing an obstacle on the ground of the tank, applying speed change, or installing an ice-filled vessel in the center of the tank, basic circulation phenomena can be observed. The experimental set up is shown in figure \ref{fig:Experiment}.

	\begin{figure}[H]
		\centering
		\captionsetup{width=0.9\textwidth}
		\includegraphics[width=0.4\textwidth]{Experiment.jpg}
		\caption[Experimental set-up]{A tank is set on a turntable, which can be rotated at different speeds. The tank can be viewed through a co-rotating overhead camera. Picture from \cite{Schneider}}
		\label{fig:Experiment}
	\end{figure}

	The observable phenomena include Taylor columns, Ekman layers and spirals, western boundary currents and, due to the temperature gradient that is induced by the ice bucket, thermal wind, Hadley circulation and baroclinic eddies.
	
	All of these phenomena can be explained with one equation, the Navier-Stokes equation, and certain idealizations and assumptions. The equation and the idealizations are explained in chapter 2, based on the book ``Atmosphere, ocean and climate dynamics: an introductory text" from John Marshall and Alan Plumb \cite{Marshall1965}.
	
	\subsection{Goals}
	
	This thesis should give a first insight into climate modeling and numerical simulation and a basic understanding of the large scale flows that are mentioned above.
		
	The main goal of this thesis is to simulate the experiment on the computer and compare the results with the expectations from the theory and the experiment. The simulation is done by numerically solving the Navier-Stokes equation for a rotating cylindrical tank using the Finite Difference Methon in Python.
	We chose to use Python, because it is widely used in various fields and offers a free, easy to use scientific data visualizer, MayaVi. Another advantage was that Python is considered easy to learn, because it has a clear and concise syntax.
	Furthermore, the thesis should give a first insight into climate modeling and numerical simulation. 
	
%	The main goal is to numerically solve the Navier-Stokes equation for a rotating cylindrical tank and visualize the results in a vector plot. 
%	
%	- Simulation of the experiment that is done in the lab course
%	
%	- Comparison of the theoretical results with the results of the experiment

\newpage

\section{Physical background}
	In this chapter the basic physical background for the following calculations is provided. This includes the general Navier-Stokes equation, as well as the Navier-Stokes equation in a rotating frame in cylindrical coordinates. The simplifications and assumptions needed for hydrostatic and geostrophic balance, and especially thermal wind are explained.
	
	\subsection{Navier-Stokes and Continuity Equation}
		
		The state of the atmosphere and the ocean at any time is defined by six key variables:
		The velocity of the fluid $\vec{u}=(u,v,w)$; pressure $p$; temperature $T$ and specific humidity in the atmosphere or salinity in the ocean. Since we are looking at fresh water in a tank, our fluid is defined by the velocity, pressure and temperature. The forces on an elementary parcel of such a fluid, following the parcel, are described by the equation of motion, known as the Navier-Stokes equation
		\begin{equation}
			\rho \frac{D\vec{u}}{Dt} = -\rho g \hat{\vec{z}} - \vec{\nabla} p + \rho \vec{\mathcal{F}} ,
			\label{eq:Simple NSG}
		\end{equation} 
		
		where the first term on the right hand side stands for the effect of gravity and $\rho$ is the density; the second term is the pressure gradient and $\vec{\mathcal{F}}$ are frictional terms.
		
		On the left hand side we have the Lagrangian (or total) derivative:
		\begin{equation}
			\frac{D}{Dt} = \frac{\partial}{\partial t} + \vec{u}.\vec{\nabla}.
			\label{eq:Lag Dev}
		\end{equation} 
		
		
		Since no mass should be given away or come into our fluid, and no mass is converted to energy, our fluid also needs to follow conservation of mass, which leads to the continuity equation:
		\begin{equation}
			\frac{D\rho}{Dt} + \rho \vec{\nabla} \vec{u} = 0 .
			\label{eq:Continuity}
		\end{equation}
		
		The water we are studying forms an incompressible flow, the density is constant in time % schlechte Formulierung
		 $\frac{\partial\rho}{\partial t} =0 $, therefore we can simplify the continuity equation (\ref{eq:Continuity}) to
		 
		\begin{equation}
			\vec{\nabla} \vec{u} = 0 ,
			\label{eq:nondivergence}
		\end{equation}
		which gives us a non-divergent flow.
		
		% Dieser Abschnitt ist vollständig aus Plumb-Buch (S.84ff)
		
		\subsubsection{Equation of motion in a rotating frame}		% Maybe as sub- instead of subsubsection
			To be used in our set-up, equation (\ref{eq:Simple NSG}) needs to be transformed into a rotating reference frame. We start by the relation of the velocity in the inertial frame $\vec{u}_{in}$ and the velocity in the rotating frame $\vec{u}_{rot}$:
			\begin{equation}
				\vec{u}_{in} = \vec{u}_{rot} + \vec{\Omega}\times\vec{r} ,
				\label{eq:Velocity Frames}
			\end{equation}
			
			where $\vec{r}$ is the position vector of a parcel in the rotating frame, and $\vec{\Omega}$ is the rotation vector of the rotating frame.
			
			Using the transformation rule % given in Alan-Plumb-Book (page 94)
			\begin{equation}
				\left(\frac{D\vec{u}_{in}}{Dt}\right)_{in} = \left(\frac{D\vec{u}_{rot}}{Dt}\right)_{rot} + 2\vec{\Omega}\times\vec{u}_{rot} + \vec{\Omega}\times\vec{\Omega}\times\vec{r} ,
				\label{eq: Lag Dev Rot}
			\end{equation}
			
			we get the Navier-Stokes equation in a rotating frame:
			
			\begin{eqnarray}
				\frac{\partial\vec{u}}{\partial t}
				= - \left(\vec{u}\cdot\vec{\nabla}\right)\vec{u} - 2\vec{\Omega}\times\vec{u} - \vec{\Omega}\times\vec{\Omega}\times\vec{r} - g\hat{\vec{z}} - \frac{1}{\rho}\vec{\nabla}p + \vec{\mathcal{F}}
				\nonumber \\
				= \underbrace{\nu\Delta\vec{u}}_{1} - \underbrace{\left(\vec{u}\cdot\vec{\nabla}\right)\vec{u}}_{2} - \underbrace{2\vec{\Omega}\times\vec{u}}_{3}- \underbrace{\vec{\Omega}\times\vec{\Omega}\times\vec{r}}_{4} - \underbrace{g\hat{\vec{z}}}_{5} - \underbrace{\frac{1}{\rho}\vec{\nabla}p}_{6}
				\label{eq: NSG}
			\end{eqnarray}
			
			Because we will stay in the rotating frame now, the subscripts ``rot" have been dropped for better readability. The different terms in this equation are:
			
				\begin{enumerate}
					\item Frictional effects with kinematic viscosity $\nu$
					\item Advection (from the Lagrangian derivative)
					\item Coriolis acceleration
					\item Centrifugal acceleration
					\item Gravitational acceleration
					\item Pressure gradient acceleration
				\end{enumerate}
			
			Now this is a non-linear, time-space-coupled, partial differential equation of 2nd order (in space), which cannot be solved analytically and has to be treated numerically.
			
		\subsubsection{Non-dimensionalization}
			
			To prevent rather tedious computations in the later numerical treatment of the Navier-Stokes equation, it is desirable to use dimensionless representations of the variables, and therefore a non-dimesionalized version of the equation. We start off with choosing a typical length $L$ and a typical velocity $U$ as references:
			
			\begin{equation}
			u_i = U \cdot {u_i}^*, \quad x_i = L \cdot {x_i}^*, \quad \partial_i = \frac{1}{L}{\partial_i}^* ,
			\nonumber
			\end{equation}
			
			
			where ${u_i}^*$ and ${x_i}^*$ are the dimensionless variables. Inserting this in  the equation of motion (\ref{eq: NSG}) in tensor notation gives us the dimensionless versions of the other variables
			\pagebreak
			
			\begin{equation}
			t^* = \frac{U}{L} t , \quad p^* = \frac{1}{U^2\rho} p , \quad {\Omega_j}^* = \frac{L}{U} \Omega_j , \quad g^* = \frac{L}{U^2} g ,
			\nonumber
			\end{equation}
			
			and therefore the non-dimensionalized equation of motion in tensor notation:
			
			\begin{eqnarray}
			{\partial_t}^*{u_i}^* &=& \frac{1}{Re}{\partial_j}^*{\partial_j}^*{u_i}^* - {u_j}^*{\partial_j}^*{u_i}^* -{\partial_i}^*p^* - g^*\hat{z}_i 
			\nonumber \\
			&&- 2\epsilon_{ijk}{\Omega_j}^*{u_k}^* - \epsilon_{ijk}\epsilon_{klm}{\Omega_j}^*{\Omega_l}^*{r_m}^* ,
			\label{eq:NonDim NSG}
			\end{eqnarray}
			
			where we use Einstein's sum convention and where $Re$ is the Reynolds number $Re = \frac{U\cdot L}{\nu}$.
		
		\subsubsection{Equation of motion in component form in cylindrical coordinates}
			Converting the equation from Cartesian coordinates to cylindrical coordinates was quite time consuming, especially the conversion of the $(\vec{u} \cdot \nabla)\cdot\vec{u}$ term.
			The components of the Navier-Stokes equation in cylindrical coordinates in a rotating frame are:
			
			\begin{eqnarray}
				\partial_t u &=& \frac{1}{Re} \Big({\partial_r}^2 u + \frac{1}{r} \partial_r u + \frac{1}{r^2} {\partial_\phi}^2 u + {\partial_z}^2 u - \frac{2}{r^2} \partial_\phi v - \frac{u}{r^2} \Big) \nonumber \\
				&& + \frac{v^2}{r} - u \partial_r u - \frac{v}{r} \partial_\phi u - w \partial_z u + 2\Omega v + \Omega^2 r - \partial_r p , 
				\label{eq:NSG cyl u}
				\\
				\partial_t v &=& \frac{1}{Re} \Big({\partial_r}^2 v + \frac{1}{r} \partial_r v + \frac{1}{r^2} 
				{\partial_\phi}^2 v + {\partial_z}^2 v - \frac{2}{r^2} \partial_\phi u - \frac{v}{r^2} \Big) \nonumber \\
				&& + \frac{u\cdot v}{r} - u \partial_r v - \frac{v}{r} \partial_\phi v - w \partial_z v - 2\Omega u - \frac{1}{r}\partial_\phi p ,
				\label{eq:NSG cyl v}
				\\
				\partial_t w &=& \frac{1}{Re} \Big({\partial_r}^2 w + \frac{1}{r} \partial_r w + \frac{1}{r^2} {\partial_\phi}^2 w + {\partial_z}^2 w \Big) \nonumber \\
				&& - u \partial_r w - \frac{v}{r} \partial_\phi w - w \partial_z w - \partial_z p - g .
				\label{eq:NSG cyl w}
			\end{eqnarray}
		
		
	\subsection{Hydrostatic Balance}
		If we take a look at the vertical component of the equation of motion in a non-rotating frame (\ref{eq:Simple NSG}),
		
		\begin{eqnarray}
		\frac{\partial w}{\partial t} = - u \frac{\partial w}{\partial x} - v \frac{\partial w}{\partial y} - w \frac{\partial w}{\partial z} - \frac{1}{\rho} \frac{\partial p}{\partial z} - g + \mathcal{F}_z ,
		\label{eq:Simple NSG z}
		\end{eqnarray}
		
		and if friction and the vertical acceleration $\frac{Dw}{Dt}$ are negligible, we obtain:
		\begin{equation}
		\frac{\partial p}{\partial z} = -\rho g ,
		\label{eq:Hydrostat Balance}
		\end{equation}
	
		which is the equation of hydrostatic balance. This is a good approximation for large-scale systems with weak vertical motions. Since we have very weak vertical motions in our case, it should be applicable.
		
	\subsection{Geostrophic Balance} % Evtl. noch etwas mehr zur Rossby Zahl
		%We assume that we already have a solid body rotation in ou system, which means that the velocity of our fluid in the rotating reference frame equals zero, $\vec{u} = 0$.
		If we look at a system where friction can be neglected, and which is stationary, i.e. an equilibrium is reached and $\frac{D\vec{u}}{Dt}=0$, the Navier-Stokes equation turns into
		
		\begin{equation}
			2\vec{\Omega} \times \vec{u} +  g\hat{\vec{z}} + \vec{\nabla} p = 0 .
			\label{eq:Geostrophic Balance}
		\end{equation}
		
		This equation describes geostrophic balance, where the pressure gradient is balanced by the Coriolis term. This approximation holds if the Rossby number 
		
		\begin{equation}
			R_0 = \frac{U}{f L}
			\label{eq:Rossby Number}
		\end{equation}
		
		is small enough. Here $f$ is the Coriolis term, which simplifies to $f=2\Omega$ in our case, $U$ is a typical magnitude for the velocity of the fluid, and $L$ is a characteristic length scale of the system. In our case, we expect the value of $\vec{u}$ to be smaller than the rotation speed, therefore $U \leq \Omega \cdot L$ and $R_0 \leq \nicefrac{1}{2}$.
		
%		Assuming that vertical velocities are much smaller than the horizontal ones, % from Plumb p. 102
%		we neglect terms including the vertical velocity $w$
		Neglecting vertical velocities, we get the geostrophic current, which is the velocity which exactly satisfies equation (\ref{eq:Geostrophic Balance}):
		
		\begin{equation}
			\vec{u}_g = \frac{1}{2\Omega \rho} \hat{\vec{z}} \times \vec{\nabla}p .
			\label{eq:Geostroph current}
		\end{equation}
		
		\subsubsection{Thermal Wind equation}
			So far we have assumed that the density is constant. But if the temperature varies in our fluid, also the density is not going to be constant. We can write the density in the following form:
			
			\begin{equation}
				\rho = \rho_{ref} + \sigma ,
				\label{eq:Density}
			\end{equation} 
		
		where $\rho_{ref}$ is a constant reference density and $\sigma$ is the variation of the density about this reference. % eins zu eins aus plumb p. 119-120
		
		Now, taking the derivative with respect to $z$ of the geostrophic motion (\ref{eq:Geostroph current}), replacing $\rho$ with $\rho_{ref}$ and using the hydrostatic equation (\ref{eq:Hydrostat Balance}), gives us
		
		\begin{equation}
			\frac{\partial \vec{u}_g}{\partial z} = - \frac{g}{2\Omega \rho_{ref}} \hat{\vec{z}} \times \vec{\nabla} \sigma ,
		\end{equation}
		
		and using $\sigma \propto \alpha T$ from \cite{Marshall1965}:
		
		\begin{equation}
			\frac{\partial \vec{u}_g}{\partial z} = - \frac{\alpha g}{2\Omega \rho_{ref}} \hat{\vec{z}} \times \vec{\nabla} T ,
		\end{equation}
		
		where $\alpha$ is the thermal expansion coefficient. This is the thermal wind relation connecting the vertical shear of the geostrophic motion to horizontal temperature gradients. In our case of the rotating water tank in cylindrical coordinates with a purely radial temperature gradient, this simplifies even more to an equation for only the azimuthal component of the velocity:
		
		\begin{equation}
			\frac{\partial v}{\partial z} = \frac{\alpha g}{2\Omega} \frac{\partial T}{\partial r} .
			\label{eq:Thermal Wind}
		\end{equation}
		
	\newpage		
\section{Numerical Solution}
	There are different methods to numerically solve differential equations like the ones we obtained. The model of the rotating cylinder has a very simple geometry, thus it is not necessary to have a highly flexible grid. We therefore chose to use the finite difference method (FDM), where the considered region is decomposed into an equidistant grid and the (partial) derivations are approximated by finite differences. The solution is therefore obtained stepwise. 
	
	
	\subsection{Staggered Grid} % Mehr Text, evtl. mehr Erklärung zum Grid
		First, we need to discretize our tank. We were expecting a lot of time steps and, due to pressure readjustment (see below), even more calculation steps inside every time step. Therefore, we chose to use a staggered grid, instead of a grid where every value is being calculated at every point. This should save us a lot of calculation time. It also makes sense because in the discretized equations (\ref{eq:Discrete u} - \ref{eq:Discrete w}), we often need to access the neighboring points. With a staggered grid, the step size can thus be cut in half. This way we might be able to avoid instabilities like oscillations of the solution.
		
		On the staggered grid, the velocity components and the pressure are calculated at different points. Figure \ref{fig:Grid} shows a section of the grid that was used.
		
		\begin{figure}[H]
			\centering
			\captionsetup{width=0.9\textwidth}
			\includegraphics[width=0.5\textwidth]{Grid2.JPG}
			\caption[Staggered grid in cylindrical coordinates]{Staggered grid in cylindrical coordinates. Picture taken from http://geophysics.geoscienceworld.org/content/68/5/1731/F1.expansion.html and edited.} % von http://geophysics.geoscienceworld.org/content/68/5/1731/F1.expansion.html
			\label{fig:Grid}
		\end{figure}
		
		One problem that occurred during the evolution of this project was the treatment of the point in the center of the tank. Maintaining the grid up to the center yields $n_\phi$ grid points which all describe the same location and should therefore have the same value. However, it could happen that we don't calculate the exact same value at every angle. We have therefore tried different variants of center treatment. We tried to average the value of the points in the center. Another idea was to use only one point in the center, and all surrounding points of the grid would then access this point. With only one point in the center we could still either calculate or set the value of this point.
		
		Another question was, whether we need the radial, azimuthal or vertical velocity in the center. In the latest version, we decided to set the value of the pressure in the center and calculate one value for the vertical velocity $w$. 
		
	\subsection{Discretization} % Mehr einleitender Text vor Unterkapitel
		Next we need to discretize the equation of motion in cylindrical coordinates (\ref{eq:NonDim NSG}) and (\ref{eq:Thermal Wind}). Therefore, we need to change all derivatives to finite differences. 
		
		\subsubsection{Navier-Stokes equation}
			The first derivative with respect to time is calculated with the forward finite difference
			
			\begin{equation}
				\frac{\partial f(\vec{x}, t)}{\partial t} = \frac{f(\vec{x},t+\delta t) - f(\vec{x}, t)}{\delta t} = \frac{f'(\vec{x},t) - f(\vec{x}, t)}{\delta t} .
				\label{eq:ForwDiv Time}
			\end{equation}
			
			Away from the edge of the tank we use the central difference for the calculation of the first and second spatial derivative % Was ist Ortsableitung ??
			
			\begin{eqnarray}
				\frac{\partial f(x,t)}{\partial x} &=& \frac{f(x + \delta x,t) - f(x - \delta x,t,)}{2\delta x}
				\label{eq:CentrDiv Space}
				\\
				\frac{\partial^2 f(x,t)}{\partial x^2} &=& \frac{f(x+\delta x,t) - 2f(x,t) + f(x - \delta x,t)}{\left(\delta x\right)^2} ,
				\label{eq:2CentrDiv Space}
			\end{eqnarray}
			
			We apply the forward finite difference on the left-hand side of equation (\ref{eq:NSG cyl u}), (\ref{eq:NSG cyl v}) and (\ref{eq:NSG cyl w}) and solve for $u'(r,\phi,z) = u(\vec{r}, t+\delta t)$, $v'(r,\phi,z) = v(\vec{r}, t+\delta t)$ and $w'(r,\phi,z) = w(\vec{r}, t+\delta t)$. Applying the grid, with $i$ as the radial, $j$ as the azimuthal and $k$ as the vertical index, hands us the following discrete equations:
			
			%{\allowdisplaybreaks
			\begin{eqnarray}
				u'[i,j,k] &=& u[i,j,k]	\nonumber \\
				&& +\delta t \Bigg[\frac{1}{Re}\bigg(\frac{u[i+1,j,k]-2u[i,j,k]+u[i-1,j,k]}{(\delta r)^2}	\nonumber \\
				&& + \frac{1}{{r_u}^2}\frac{u[i,j+1,k]-2u[i,j,k]+u[i,j-1,k]}{(\delta \phi)^2}	\nonumber \\
				&& + \frac{u[i,j,k+1] - 2u[i,j,k] +u[i,j,k-1]}{(\delta z)^2}	\nonumber \\
				&& - \frac{2}{{r_u}^2}\frac{\frac{1}{2}\left(v[i+1,j,k]+v[i,j,k]\right)-\frac{1}{2}\left(v[i+1,j-1,k]+v[i,j-1,k]\right)}{\delta \phi}	\nonumber \\
				&& - \frac{u[i,j,k]}{{r_u}^2}\bigg) - \left(\frac{1}{Re\cdot r_u} - u[i,j,k]\right)\frac{u[i+1,j,k]-u[i-1,j,k]}{2\delta r}	\nonumber \\
				&& + \frac{1}{r_u}\bigg(\left(v_u[i,j,k]\right)^2 - v_u[i,j,k] \cdot \frac{u[i,j+1,k]-u[i,j-1,k]}{2\delta \phi}\bigg)	\nonumber \\
				&& - w_u[i,j,k] \cdot \frac{u[i,j,k+1]-u[i,j,k-1]}{2\delta z} + \Omega^2 r_u	\nonumber \\
				&& - \frac{p[i+1,j,k]-p[i,j,k]}{\delta r} \Bigg] ,
				\label{eq:Discrete u}
			\end{eqnarray}
			%}
			\begin{eqnarray}
				v'[i,j,k] &=& v[i,j,k]	\nonumber \\
				&& + \delta t \Bigg[ \frac{1}{Re} \bigg( \frac{v[i+1,j,k]-2 v[i,j,k]+v[i-1,j,k]}{(\delta r)^2}	\nonumber \\
				&& + \frac{1}{{r_p}^2} \frac{v[i,j+1,k]-2v[i,j,k]+v[i,j-1,k]}{(\delta \phi)^2}	\nonumber \\
				&& + \frac{v[i,j,k+1]-2v[i,j,k]+v[i,j,k-1]}{(\delta z)^2}	\nonumber \\
				&& + \frac{2}{{r_p}^2} \frac{\frac{1}{2}\left(u[i,j,k]+u[i-1,j,k]\right)-\frac{1}{2}\left(u[i,j+1,k]+u[i-1,j+1,k]\right)}{\delta\phi} \nonumber \\
				&& - \frac{v[i,j,k]}{{r_p}^2} \bigg) + \bigg( \frac{1}{Re\cdot r_p} - u_v[i,j,k] \bigg) \cdot \frac{v[i+1,j,k]-v[i-1,j,k]}{2\delta r} \nonumber \\
				&& - \frac{v[i,j,k] \cdot u_v[i,j,k]}{r_p} - \frac{v[i,j,k]}{r_p}\cdot \frac{v[i,j+1,k]-v[i,j-1,k]}{2\delta \phi} \nonumber \\
				&& - w_v[i,j,k] \cdot \frac{v[i,j,k+1]-v[i,j,k-1]}{2\delta z} \nonumber \\
				&& - 2\Omega\cdot u_v[i,j,k] - \frac{1}{r_p} \frac{p[i,j+1,k]-p[i,j,k]}{\delta \phi}
				\Bigg] ,
				\label{eq:Discrete v}
			\end{eqnarray}
						
			\begin{eqnarray}
				w'[i,j,k] &=& w[i,j,k]	\nonumber \\
				&& + \delta t \Bigg[ \frac{1}{Re} \bigg( \frac{w[i+1,j,k]-2w[i,j,k]+w[i-1,j,k]}{(\delta r)^2} \nonumber \\
				&& + \frac{1}{{r_p}^2} \frac{w[i,j+1,k]-2w[i,j,k]+w[i,j-1.k]}{(\delta\phi)^2} \nonumber \\
				&& + \frac{w[i,j,k+1]-2w[i,j,k]+w[i,j,k-1]}{(\delta z)^2} \bigg) \nonumber \\
				&& - \bigg(\frac{1}{Re\cdot r_p} - u_w \bigg) \cdot \frac{w[i+1,j,k]-w[i-1,j,k]}{2 \delta r} \nonumber \\
				&& - \frac{v_w[i,j,k]}{r_p} \frac{w[i,j+1,k]-w[i,j-1,k]}{2\delta \phi} \nonumber \\
				&& - w[i,j,k] \frac{w[i,j,k+1]-w[i,j,k-1]}{2\delta z} \nonumber \\
				&& - \frac{p[i,j,k+1]-p[i,j,k]}{\delta z} -g
				\Bigg] ,
				\label{eq:Discrete w}
			\end{eqnarray}
			
			
			where $r_u$ is the radius at the position $i$ on the $u$-grid, and $r_p$ is the radius at the position $i$ on the $p$-, $v$-, or $w$-grid.
			
			Wherever we need to access the value of a component at a point where its grid has no value, the value of the component is interpolated linearly. These interpolations are then shortened to $u_v$ for the value of $u$ on the grid of $v$, $v_u$ for the value of $v$ on the grid of $u$, and so on.
			
			\begin{eqnarray}
				%v_p[i,j,k] = \frac{1}{2}\left(v[i,j,k]+v[i,j-1,k]\right) %-> kann man verwenden, macht aber nicht so sinn
				v_u[i,j,k] &=& \frac{v[i,j,k]+v[i,j-1,k]+v[i+1,j-1,k]+v[i+1,j,k]}{4} \nonumber \\
				w_u[i,j,k] &=& \frac{w[i,j,k]+w[i+1,j,k]+w[i,j,k-1]+w[i+1,j,k-1]}{4}	\nonumber \\
				%u_p[i,j,k] &=& \frac{u[i,j,k]+u[i-1,j,k]}{2} \nonumber \\ % aus konsistenzgründen lieber darauf verzichten?
				u_v[i,j,k] &=& \frac{u[i,j,k]+u[i-1,j,k]+u[i,j+1,k]+u[i-1,j+1,k]}{4} \nonumber \\
				w_v[i,j,k] &=& \frac{w[i,j,k]+w[i,j+1,k]+w[i,j,k-1]+w[i,j+1,k-1]}{4} \nonumber \\
				u_w[i,j,k] &=& \frac{u[i,j,k]+u[i-1,j,k]+u[i,j,k+1]+u[i-1,j,k+1]}{4} \nonumber \\
				v_w[i,j,k] &=& \frac{v[i,j,k]+v[i,j-1,k]+v[i,j,k+1]+v[i,j-1,k+1]}{4} \nonumber
			\end{eqnarray}
			
			We now have three expressions which only depend on the previous time step and the pressure. Therefore we need to readjust the pressure after every time step, which is done in section 3.3 .
			
		\subsubsection{Thermal wind equation}
			To discretize the thermal wind equation (\ref{eq:Thermal Wind}), we use a forward difference for the first derivative of the azimuthal velocity with respect to $z$ and a centred difference for the first derivative of $T$. Solving these equation for $v(r,\phi, z+1)$, and again using the indices $[i,j,k]$ instead of $(r,\phi,z)$, yields:
			
			\begin{equation}
			v[i,j,k+1] = v[i,j,k] + \delta z \frac{\alpha g}{2\Omega} \frac{T[i+1,j,k]-T[i,j,k]}{\delta r}
%				v(r,\phi, z+1) = v(r,\phi,z) + \delta z \frac{\alpha g}{2\Omega} \frac{T(r+1,\phi,z) - T(r-1,\phi, z)}{2 \delta z}
				\label{eq:Discrete Thermal v}
			\end{equation}
		
			
	\subsection{Pressure readjustment} % Evtl. mehr Erklärung, wieso diese Methode gewählt wurde
		In the discrete expressions of the Navier-Stokes equation, we use the pressure of the previous time step to calculate the velocity $\vec{u}(\vec{r},t+\delta t)$. In general, this velocity will not satisfy the continuity equation of a non-divergent flow, $\vec{\nabla} \vec{u} \neq 0$. Taking the divergence of equation (\ref{eq: NSG}) yields a Poisson equation for the pressure
		
		\begin{equation}
			\vec{\nabla} \cdot \vec{\nabla} p = \Delta p = f(\vec{u})
			\label{eq:Poisson Pressure}
		\end{equation}
		
		% Hier Referenz zum Fluiddynamik.pdf
		A Poisson equation can be solved with a modified Richardson iteration, as suggested by \cite{Schmittfull2005}. % hier Referenz auf Wikipedia (en.wikipedia.org/wiki/Modified_Richardson_iteration)
		
		\begin{eqnarray}
			p_{n+1} &=& p_n - \lambda \left(f(\vec{u}) - \Delta p_n\right)
			\nonumber \\
			&=& p_n - \lambda \frac{1}{\delta t} \vec{\nabla}\vec{u}
			\label{eq:Drucknachregelung p}
		\end{eqnarray}
		
		Inserting this solution in our expressions for the velocity yields:
		
		\begin{eqnarray}
			u'_{n+1} &=& u'_n + \lambda \partial_r (\vec{\nabla}\vec{u}'_n), \\
			v'_{n+1} &=& v'_n + \lambda \frac{1}{r} \partial_\phi (\vec{\nabla}\vec{u}'_n), \\
			w'_{n+1} &=& w'_n + \lambda \partial_z (\vec{\nabla}\vec{u}'_n),
			\label{eq:Drucknachregelung uvw}
		\end{eqnarray}
		
		This iteration can now be continued until the condition $\vec{\nabla}\vec{u}=0$ is satisfied sufficiently accurate. 
	
	\subsection{CFL-Criterion} % Referenz auf Buch und wenn möglich, etwas mehr Erklärung
		To make sure that our iteration is going to be stable, we apply the Courant-Friedrichs-Levy criterion
		
		\begin{equation}
			C = \delta t \sum_{i=0}^3 \frac{U_i}{\delta x_i} \leq 1 ,
			\label{eq:CFL}
		\end{equation}
		 
		which must be satisfied in order to obtain stable numerical solutions using central differences. It links the velocity of the fluid to the resolution of the space-time grid required to resolve the flow \cite{Stocker2009}.
		We choose our time step $\delta t$ to be small enough for the given $U_i$ and $\delta x_i$.
		
		
	\newpage
\section{Implementation and Visualization}

	We chose to implement the equations in Python, since it is a widely used programming language in physics and is easy to understand and use. Python supports the use of three dimensional arrays, which are used to store the velocities at the grid points. For the visualisation we used MayaVi, which is a scientific data visualizer written in Python and provides the tools for three dimensional vector plots.

	\subsection{Numercial Solution of the Navier-Stokes equation}
		
		\subsubsection{The Concept}
			The first step of the algorithm is the initialisation of the variables and initial conditions. To test the program, we set the initial velocities to zero, in order to test if the balance could be kept. For the calculations and to store the results we had to initialise a $n_r \times n_\phi \times n_z$ - matrix for every velocity component and for the pressure. \\
			
			The second step is the iteration over the time steps. In each time step the components of the velocity are calculated from the velocity of the previous time step, using equations (\ref{eq:Discrete u}), (\ref{eq:Discrete v}) and (\ref{eq:Discrete w}). At the edge of the tank, e.g. for $i=i_{max}$ or $k=k_{min}$, we need to use backward spatial differences and for the calculations in the center of the tank we need to use forward spatial differences - these cases are calculated separately as special cases in the code.
			
			The velocities that were calculated that way were not divergence free, hence the balance could not be hold, even after only one time step. Therefore, the pressure needs to be readjusted inside every time step. In order to do this the divergence of $\left(u'[i,j,k], v'[i,j,k], w'[i,j,k]\right)$ is calculated and the pressure readjustment equations (\ref{eq:Drucknachregelung p}) and (\ref{eq:Drucknachregelung uvw}) are applied in a while-loop, until the divergence of the velocity gets sufficiently small.
			After that, the next time step is calculated.
			
			Either inside every time step, or after the iteration over time is done, the results could be visualized.

		\subsubsection{Outcome and Discussion}
			Unfortunately we couldn't obtain any insights with the program because the calculated velocity was divergent. Even after only one time step, the initial balance of the solid body rotation was already lost. We thought that a regulation of the pressure  could fix this problem, but with pressure readjustment we still  didn't get a non-divergent velocity, although we tried different versions of pressure readjustment. 
			We tried the method presented in section 3.3, and we also tried the method described in \cite{Schmittfull2005}
			, which is slightly different. It uses that $p_{n+1} = p_n - \lambda \vec{\nabla} \vec{u}_n$ and that $u_{i_{n+1}} = u_{i_{n}} - \delta t \lambda \vec{\nabla}{\vec{u}_n}^T$. But none of these methods could fix the problem.\\
			
			Since the problem seemed to originate from the edges and the center of the tank, we tried different types of the grid, where we would either calculate the values in the center from the equations or just set them to a reasonable value, or where we would even avoid having any grid points in the exact center. For the outer edge, we also tried different boundary conditions, like the no-slip condition, where we would set the values at the edge to zero, since they must have the same velocity as the tank.
			
			We also tried to calculate the vertical velocity $w$ from the other two components using the continuity equation (\ref{eq:nondivergence})
			
			\begin{eqnarray}
				w[i,j,k+1] &=& w[i,j,k]
				\nonumber \\
				&&- \delta z \Bigg( \frac{1}{r_p}\bigg( \frac{u[i,j,k]+u[i,j,k+1]+u[i+1,j,k]+u[i+1,j,k+1]}{4}
				\nonumber \\
				&&+ \frac{v[i,j+1,k]+v[i,j+1,k+1]-v[i,j,k]-v[i,j,k+1]}{2\delta\phi} \bigg) 
				\nonumber \\
				&&+\frac{u[i+1,j,k]+u[i+1,j,k+1]-u[i,j,k]-u[i,j,k+1]}{2\delta r} \Bigg)
				\label{eq: neues w_c}
			\end{eqnarray}
			
			First, we only calculated the vertical velocity in the center this way, but after this did not work either, we calculated the vertical velocity on every point from this condition. But even applying the continuity equation on $w$ would not give us a non-divergent flow.
			
			We could not find out whether the divergence of the velocity was connected to a mistake in the program or to a numerical mistake. Since it is a rather long program with long equations and many similar looking terms, it is highly probable that there are still many unseen mistakes or typing errors inside the program.
			
			We further suggest that the pressure adjustment method proposed by \cite{Schmittfull2005} may not be suitable for the simulation of a three-dimensional water tank; although our adoption from two dimensions to three dimensions may also be flawed.
			
			If the attempt at simulating a cylindrical water tank is repeated, we recommend using the vorticity formulation of the Navier-Stokes equation, in which the pressure does not appear.
			
			\newpage
			
	\subsection{Simulation of Thermal Winds}
		Since the numerical solution of the full Navier-Stokes equation did not work, we decided to visualize one of the phenomena of the Lab Course. Thermal wind seemed to be the most interesting phenomenon to simulate. The corresponding experiment is shown in figure \ref{fig:TWExperiment} and explained below.
		
		\begin{figure}[h]
		%\begin{minipage}{0.8\textwidth}
		%\begin{center}
			\centering
			\captionsetup{width=0.8\textwidth}
			\includegraphics[width=0.8\textwidth]{ThermalWindExp.jpg}
			\caption[Experiment Thermal Wind]{Left side: Rotating cylindrical tank filled with water and a can in its center, which is filled with ice. Right side: The radial temperature gradient should cause a circulation in the tank. \cite{Marshall1965}}
			\label{fig:TWExperiment}
		%\end{center}
		%\end{minipage}
		\end{figure}
		
		We place a cylindrical tank with a can in its center on a turntable. The tank is filled with water to a depth of about $\unit[20]{cm}$, and the turntable is rotated slowly ($\Omega < \unit[1]{rpm}$). After solid body rotation is achieved, the can is filled with ice, which induces a radial temperature gradient. A thermal wind shear develops in balance with it, as sketched in figure \ref{fig:TWExperiment} on the right.
		\newline
		In the lab the circulation, caused by the thermal wind shear, can be seen by adding some dye in the water. The dye streaks are tilted over into a corkscrew pattern by an azimuthal current and form a spiral around the ice-filled can in the center. Pictures of it can be seen in figure \ref{fig:TWExp1} and \ref{fig:TWExp2}.
		
		% Foto aus dem Buch, etwas schönes als eigene Fotos, aber halt aus dem Buch...
%		\begin{figure}
%		%	\begin{minipage}{0.8\textwidth}
%				\centering
%				\includegraphics[width=0.8\textwidth]{TWExpRes.jpg}
%				\caption{Photograph of the experiment from \todoRef{Plumb Book}. The green dye streaks show the thermal wind, that is induced by the radial temperature gradient.}
%				\label{fig:TWExpBook}
%		%	\end{minipage}
%		\end{figure}
		
		\begin{figure}
		%	\begin{minipage}{0.8\textwidth}
				\centering
				\captionsetup{width=0.9\textwidth}
				\subfloat{
				\includegraphics[width=0.4\textwidth]{k1.jpg}
				\label{fig:TWExp1}}
		%	\end{minipage}
		%	\begin{minipage}{0.8\textwidth}
				\subfloat{
				\includegraphics[width=0.4\textwidth]{k3b.jpg}
				\label{fig:TWExp2}}
		%	\end{minipage}
			\caption[Photographs of Thermal Wind Experiment]{Photographs of the experiment in the Lab Course. The blue dye shows the corkscrew pattern that is formed by the thermal wind.}
		\end{figure}
		
		
		\subsubsection{The Concept}  % Wohl noch etwa ausbauen!
			For the calculation of the velocity, we need to iterate equation (\ref{eq:Discrete Thermal v}) over all grid points. Because we only need the neighboring temperature points to calculate the velocity at a certain point, we chose to use a staggered grid again. This time we have a grid for the values of the azimuthal velocity and a radially offset grid for the temperature. After the iteration we need to convert the velocity to Cartesian coordinates in order to plot the result.
			
		\subsubsection{Results and Discussion}
			With bottom boundary values of the velocity set to zero in the rotating frame, i. e. no-slip boundary conditions - which makes sense, since we presumed a solid body rotation, i. e. balance, for the calculations - we get the following results.
			
			% Bilder mit minipage machen!
			\begin{figure}[h]
				\centering
				\captionsetup{width=0.9\textwidth}
				\subfloat{
					\includegraphics[width=0.45\textwidth]{InVZeroF.jpg}
					\label{fig:TW_xy}}
				\subfloat{
					\includegraphics[width=0.45\textwidth]{InVZeroFz.jpg}
					\label{fig:TW_z}}
					\qquad
				\caption[Visualization of the velocity with bottom boundary velocity $\vec{u}=0$]{Visualization of the velocity with bottom boundary velocity $\vec{u}=0$. Vectors show the direction and value of the velocity at each point of the grid.}
			\end{figure}
			
			Those look the way we have expected it. The radial temperature gradient induced a thermal wind shear and therefore a circulation of the water. The geostrophic flow varies with height, the currents increase with height.
			
			When we are only looking at the problem away from the tank edges, we can also set the velocity  at the bottom to a different value than zero.
			
			\begin{figure}[ht]
				\centering
				\captionsetup{width=0.9\textwidth}
				\subfloat{
					\includegraphics[width=0.45\textwidth]{InVSmallPosF.jpg}
					\label{fig:TW_small_pos}}
				\subfloat{
					\includegraphics[width=0.45\textwidth]{InVSmallNegF.jpg}
					\label{fig:TW_small_neg}}
					\qquad
				\caption[Visualization of the velocity with a small bottom boundary velocity]{Visualization of the velocity with a small bottom boundary velocity $|\vec{u}|<<1$. Left: positive azimuthal velocity on the lowest simulated layer, $v>0$. Right: $v<0$.}
			\end{figure}
			
			
			For small velocities in the lowest simulated layer, the induced current is still clearly visible and is even strong enough to turn the direction of the current, as we can see in figure \ref{fig:TW_small_neg}. If we set the velocity of the bottom too high, the effects of the thermal wind shear become too small to have a noticeable effect (figure \ref{fig:TW_big_pos} and \ref{fig:TW_big_neg}).
			
			All in all, the results of the simulation show the effects that we expected. 
			
			\begin{figure}[H]
				\centering
				\captionsetup{width=0.9\textwidth}
				\subfloat{
					\includegraphics[width=0.5\textwidth]{InVBigPosF.jpg}
					\label{fig:TW_big_pos}}
				\subfloat{
					\includegraphics[width=0.5\textwidth]{InVBigNegF.jpg}
					\label{fig:TW_big_neg}}
					\qquad
				\caption[Visualization of the velocity with a big bottom boundary velocity]{Visualization of the velocity with a big bottom boundary velocity $|\vec{u}| \approx 1$. Left: positive azimuthal velocity on the lowest simulated layer, $v>0$. Right: $v<0$.}
			\end{figure}
	\newpage
\section{Conclusion}

	The goal of this thesis was to get a basic understanding of large scale ocean and atmosphere dynamics and to numerically solve the Navier-Stokes equation to computationally simulate these dynamics in a rotating water tank. \\
	First, we applied the general Navier-Stokes equation to the setting of the Lab Course experiment. To accomplish this, we had to transform the equation in a rotating frame and convert it to cylindrical coordinates. The thus obtained equation then had to be solved numerically. To achieve this, we needed to discretize the equation and apply a staggered grid to the area of the tank. And in a last step, the discretized equation was implemented and looped over time. The calculated flow was divergent, therefore the pressure needed to be readjusted after every time step. Even with pressure readjustment, the flow remained divergent. To proceed, we concentrated on the phenomenon of thermal wind and redid all the steps with the simplified thermal wind equation. The results could then be visualized in a vector plot. \\
		
	Although the main part of this thesis did not work as planned, I was still able to learn a lot from working on the program, trying to find the errors and editing it. With the necessary simplifications, we were able to visualize the effects of a purely radial temperature gradient on the motion of the water in the rotating tank. I gained a lot understanding of how numerical solutions are done. From gathering the necessary theoretical background, a much better understanding of ocean and atmosphere dynamics and where certain winds or circulations come from could be gained.
	
\section{Acknowledgements}
	I  would like to thank the advisor of this project, Patrik Pfister for the valuable guidance and advice. I would also like to thank him for always thinking ahead and knowing what topics could cause problems. And therefore, always being prepared for my questions.
	
	\newpage
	
	
	\bibliographystyle{plain} % alternativ: plainnat
	\bibliography{BALib}
	%\printbibliography
	\nocite{*}

	\newpage

\appendix
\section{Code of Thermal Wind Simulation}
	
		\begin{lstlisting}
		
		import math
		import numpy as np
		from mayavi.mlab import *
		
		pi=math.pi
		
		#   Dimensions and fixed stuff
		##  Tank size, roation, temperature
		r_t = 0.6               # in m
		r_i = 0.1               # in m
		h_t = 0.3               # in m
		omega = 2*pi/6          # in rad/s
		T0 = 273                # in K
		TR = 300				# in K
		
		##  Number of grid points
		n_r = 10
		n_phi = 8
		n_z = 10
		
		##  Stepsizes           Dimensions:
		dr = (r_t-r_i)/n_r      # m
		dphi = 2*pi/n_phi       # m
		dz = h_t/n_z            # m
		
		dT = (TR-T0)/(n_r)    	# K
		
		dri = 1/dr
		dphii = 1/dphi
		
		#   Functions for j and phi, h
		def jp(j):
		    if j==n_phi-1:
		        return 0
		    else:
		        return j+1
		def phi(j):
		    return j*2*pi/n_phi
		def h(k):
		    return k*dz
		
		
		##  Nondimensionalization
		U = 0.01                # typical size velocity in m/s
		L = dr                  # typical size coordinates in m
		
		a = 69*10**(-6)         # linear thermal expansion coefficient [a] = 1/K
		
		gn = -9.81              # gravitational constant [g] = m/S^2
		gdim = L/U**2
		g = gn/gdim             # undimensionalized version of gravity constant
		
		omegadim = L/U
		om = omega/omegadim     # undimensionalized version of omega
		
		#   Matrix initialization
		u = np.zeros((n_r,n_phi,n_z))      
		u_cart = np.zeros((n_r,n_phi,n_z))
		
		r = np.arange(r_i,r_t+dr/2, dr)
		
		v = np.zeros((n_r,n_phi,n_z))
		v_cart = np.zeros((n_r,n_phi,n_z))
		
		w = np.zeros((n_r,n_phi,n_z))
		
		T = np.ones((n_r+1,n_phi,n_z))
		
		x = np.zeros((n_r,n_phi,n_z))
		y = np.zeros((n_r,n_phi,n_z))
		z = np.zeros((n_r,n_phi,n_z))
		
		
		#   Calculations:
		for i in range(n_r):
		    for j in range(n_phi):
		        for k in range(n_z-1):
		            T[i,j,k] = T0 + (i)*dT
		            T[i+1,j,k] = T0 + (i+1)*dT
		
		            v[i,j,k+1] = v[i,j,k] + dz*(0.5*a*g/om*dri*(T[i+1,j,k]-T[i,j,k]))
		
		#	Plot
		##	Conversion to Cartesian coordinates
		for i in range(n_r):
		    for j in range(n_phi):
		        for k in range(n_z):
		            u_cart[i,j,k] = u[i,j,k]*math.cos(phi(j)) - v[i,j,k]*math.sin(phi(j))
		            v_cart[i,j,k] = u[i,j,k]*math.sin(phi(j)) + v[i,j,k]*math.cos(phi(j))
		
		            x[i,j,k] = r[i]*math.cos(phi(j))
		            y[i,j,k] = r[i]*math.sin(phi(j))
		            z[i,j,k] = h(k)
		
		##	Calling MayaVi
		quiver3d(x,y,z,u_cart,v_cart,w)
		
		\end{lstlisting}
	
	
\pagebreak
\end{document}

% % Gleichungen für u(r,phi,z), v(r,phi,z), w(r,phi,z)
%			\begin{eqnarray}
%				\frac{\partial u(r,\phi,z)}{\partial t} &=& \frac{u'(r,\phi,z)- u(r,\phi,z)}{\delta t}
%				\nonumber \\
%				&=& \frac{1}{Re} \bigg( \frac{u(r+\delta r,\phi,z)-2u(r,\phi,z)+u(r-\delta r,\phi,z)}{(\delta r)^2}
%				\nonumber \\
%								&&	+ \frac{1}{r}\frac{u(r+\delta r,\phi,z)-u(r-\delta r,\phi,z)}{2\delta r}
%				\nonumber \\
%								&&	+ \frac{1}{r^2}\frac{u(r,\phi+\delta\phi,z)-2u(r,\phi,z)+u(r,\phi-\delta\phi,z)}{(\delta \phi)^2}
%				\nonumber \\
%								&&	+ \frac{u(r,\phi,z+\delta z)-2u(r,\phi,z)+u(r,\phi,z-\delta z)}{(\delta z)^2}
%				\nonumber \\
%								&&	- \frac{u(r,\phi, z)}{r^2}
%									- \frac{2}{r^2}\frac{v(r,\phi+\delta\phi,z)-v(r,\phi-\delta\phi,z)}{2\delta\phi} \bigg)
%				\nonumber \\
%				&&	+ \frac{v^2(r,\phi,z)}{r}
%					- u(r,\phi,z)\frac{u(r+\delta r,\phi,z)-u(r-\delta r,\phi,z)}{2\delta r}
%				\nonumber \\
%				&&	- \frac{v(r,\phi,z)}{r}\frac{u(r,\phi+\delta\phi,z)-u(r,\phi-\delta\phi,z)}{2\delta\phi}
%				\nonumber \\
%				&&	- w(r,\phi,z)\frac{u(r,\phi,z+\delta z)-u(r,\phi,z-\delta z)}{2\delta z}
%				\nonumber \\
%				&&	- \frac{p(r+\delta r,\phi, z)-p(r-\delta r,\phi,z)}{2\delta r}
%					+ 2\Omega v(r,\phi,z)
%					+ \Omega^2 r
%				\label{eq:Discrete u}
%			\end{eqnarray}
%			
%			\begin{eqnarray}
%				\frac{\partial v(r,\phi,z)}{\partial t} &=& \frac{v'(r,\phi,z)- v(r,\phi,z)}{\delta t}
%				\nonumber \\
%				&=& \frac{1}{Re} \bigg( \frac{v(r+\delta r,\phi,z)-2v(r,\phi,z)+v(r-\delta r,\phi,z)}{(\delta r)^2}
%				\nonumber \\
%								&&	+ \frac{1}{r}\frac{v(r+\delta r,\phi,z)-v(r-\delta r,\phi,z)}{2\delta r}
%				\nonumber \\
%								&&	+ \frac{1}{r^2}\frac{v(r,\phi+\delta\phi,z)-2v(r,\phi,z)+v(r,\phi-\delta\phi,z)}{(\delta \phi)^2}
%				\nonumber \\
%								&&	+ \frac{v(r,\phi,z+\delta z)-2v(r,\phi,z)+v(r,\phi,z-\delta z)}{(\delta z)^2}
%				\nonumber \\
%								&&	- \frac{v(r,\phi, z)}{r^2}
%									- \frac{2}{r^2}\frac{u(r,\phi+\delta\phi,z)-u(r,\phi-\delta\phi,z)}{2\delta\phi} \bigg)
%				\nonumber \\
%				&&	+ \frac{u(r,\phi,z)\cdot v(r,\phi,z)}{r}
%					- u(r,\phi,z)\frac{v(r+\delta r,\phi,z)-v(r-\delta r,\phi,z)}{2\delta r}
%				\nonumber \\
%				&&	- \frac{v(r,\phi,z)}{r}\frac{v(r,\phi+\delta\phi,z)-v(r,\phi-\delta\phi,z)}{2\delta\phi}
%				\nonumber \\
%				&&	- w(r,\phi,z)\frac{v(r,\phi,z+\delta z)-v(r,\phi,z-\delta z)}{2\delta z}
%				\nonumber \\
%				&&	- \frac{1}{r}\frac{p(r,\phi+\delta\phi, z)-p(r,\phi-\delta\phi,z)}{2\delta \phi}
%					+ 2\Omega u(r,\phi,z)
%				\label{eq:Discrete v}
%			\end{eqnarray}
%			
%			\begin{eqnarray}
%				\frac{\partial w(r,\phi,z)}{\partial t} &=& \frac{w'(r,\phi,z)- w(r,\phi,z)}{\delta t}
%				\nonumber \\
%				&=& \frac{1}{Re} \bigg( \frac{w(r+\delta r,\phi,z)-2w(r,\phi,z)+w(r-\delta r,\phi,z)}{(\delta r)^2}
%				\nonumber \\
%								&&	+ \frac{1}{r}\frac{w(r+\delta r,\phi,z)-w(r-\delta r,\phi,z)}{2\delta r}
%				\nonumber \\
%								&&	+ \frac{1}{r^2}\frac{w(r,\phi+\delta\phi,z)-2w(r,\phi,z)+w(r,\phi-\delta\phi,z)}{(\delta \phi)^2}
%				\nonumber \\
%								&&	+ \frac{w(r,\phi,z+\delta z)-2w(r,\phi,z)+w(r,\phi,z-\delta z)}{(\delta z)^2} \bigg)
%				\nonumber \\
%				&&	- u(r,\phi,z)\frac{w(r+\delta r,\phi,z)-w(r-\delta r,\phi,z)}{2\delta r}
%				\nonumber \\
%				&&	- \frac{v(r,\phi,z)}{r}\frac{w(r,\phi+\delta\phi,z)-w(r,\phi-\delta\phi,z)}{2\delta\phi}
%				\nonumber \\
%				&&	- w(r,\phi,z)\frac{w(r,\phi,z+\delta z)-w(r,\phi,z-\delta z)}{2\delta z}
%				\nonumber \\
%				&&	- \frac{1}{r}\frac{p(r,\phi,z+\delta z)-p(r,\phi,z-\delta z)}{2\delta z}
%					- g
%				\label{eq:Discrete w}
%			\end{eqnarray}

%			Endformel u:
%			{\allowdisplaybreaks
%			\begin{eqnarray}
%				u'[i,j,k] &= u[i,j,k] + \delta t \Bigg(& \frac{1}{Re}\Bigg(\frac{u[i+1,j,k]-2u[i,j,k]+u[i-1,j,k]}{(\delta r)^2}
%				\nonumber \\
%				&& + \frac{1}{{r_u}^2}\frac{u[i,j+1,k]-2u[i,j,k]+u[i,j-1,k]}{(\delta \phi)^2}
%				\nonumber \\
%				&& + \frac{u[i,j,k+1] - 2u[i,j,k] +u[i,j,k-1]}{(\delta z)^2}
%				\nonumber \\
%				&& - \frac{2}{{r_u}^2}\frac{\frac{1}{2}\left(v[i+1,j,k]+v[i,j,k]\right)-\frac{1}{2}\left(v[i+1,j-1,k]+v[i,j-1,k]\right)}{\delta \phi}
%				\nonumber \\
%				&& - \frac{u[i,j,k]}{{r_u}^2}\Bigg) - \left(\frac{1}{Re\cdot r_u} - u[i,j,k]\right)\frac{u[i+1,j,k]-u[i-1,j,k]}{2\delta r}
%				\nonumber \\
%				&& + \frac{1}{r_u}\Bigg(\left(\frac{v[i,j,k]+v[i,j-1,k]+v[i+1,j-1,k]+v[i+1,j,k]}{4}\right)^2
%				\nonumber \\
%				&& - \frac{v[i,j,k]+v[i,j-1,k]+v[i+1,j-1,k]+v[i+1,j,k]}{4}
%				\nonumber \\
%				&&\cdot \frac{u[i,j+1,k]-u[i,j-1,k]}{2\delta \phi}\Bigg)
%				\nonumber \\
%				&& - \frac{w[i,j,k]+w[i+1,j,k]+w[i,j,k-1]+w[i+1,j,k-1]}{4}
%				\nonumber \\
%				&&\cdot \frac{u[i,j,k+1]-u[i,j,k-1]}{2\delta z} + \Omega^2 r_u
%				\nonumber \\
%				&& - \frac{p[i+1,j,k]-p[i,j,k]}{\delta r} \Bigg)
%			\end{eqnarray}
%			}